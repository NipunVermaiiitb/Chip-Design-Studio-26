# VCNPU Module Completion - Visual Reference

## Module Status Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODULE STATUS MATRIX                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Module               â”‚  Before  â”‚   Now    â”‚  Complexity    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ sca.v                â”‚    âŒ    â”‚    âœ…    â”‚  Medium        â”‚
â”‚ sftm.v               â”‚    ðŸŸ¡    â”‚    âœ…    â”‚  High          â”‚
â”‚ dpm.v                â”‚    ðŸŸ¡    â”‚    âœ…    â”‚  High          â”‚
â”‚ split_prefetcher.v   â”‚    ðŸŸ¡    â”‚    âœ…    â”‚  Low-Medium    â”‚
â”‚ global_controller.v  â”‚    ðŸŸ¡    â”‚    âœ…    â”‚  Medium        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ preta_conv.sv        â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ posta_conv.sv        â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ preta_deconv.sv      â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ posta_deconv.sv      â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ gdeconv_weight...sv  â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ qmu.v                â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ scu.v                â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ credit_fsm.v         â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â”‚ group_sync_fifo.v    â”‚    âœ…    â”‚    âœ…    â”‚  Complete      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend: âŒ Missing  ðŸŸ¡ Mock/Stub  âœ… Complete
```

## Architecture Visualization

### Before (Simplified/Mock)
```
     â”Œâ”€â”€â”€â”€â”€â”€â”
     â”‚ SFTM â”‚  â† Just a counter generating dummy data
     â””â”€â”€â”¬â”€â”€â”€â”˜
        â”‚
     â”Œâ”€â”€â–¼â”€â”€â”€â”
     â”‚ FIFO â”‚
     â””â”€â”€â”¬â”€â”€â”€â”˜
        â”‚
     â”Œâ”€â”€â–¼â”€â”€â”€â”
     â”‚ DPM  â”‚  â† FSM that reads but doesn't compute
     â””â”€â”€â”€â”€â”€â”€â”˜

     [Split Prefetch]  â† Returns fixed address 0x10000000
     
     [Controller]      â† Sets flags, never clears busy
```

### After (Production Quality)
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Global Controller   â”‚
                    â”‚  â€¢ State machine    â”‚
                    â”‚  â€¢ Adaptive bypass  â”‚
                    â”‚  â€¢ Credit tracking  â”‚
                    â”‚  â€¢ Error detection  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ (enable signals)
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
      â”‚    SFTM    â”‚â”€â”€â”€â–ºâ”‚    FIFO    â”‚â”€â”€â”€â–ºâ”‚    DPM    â”‚
      â”‚ Full Pipe  â”‚    â”‚ w/ Credits â”‚    â”‚ Deformableâ”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Split Prefetch â”‚                    â”‚   Output   â”‚
    â”‚ â€¢ Address calc â”‚                    â”‚            â”‚
    â”‚ â€¢ Bounds check â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ Pre-compute  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## SFTM Pipeline Deep Dive

### Before
```
start â”€â”€â–º [Counter] â”€â”€â–º group_data (dummy)
```

### After
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              SFTM Pipeline                   â”‚
                    â”‚                                              â”‚
input_data â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
input_valid     â”‚ Input â”‚â”€â”€â”€â”€â–ºâ”‚PreTA â”‚â”€â”€â”€â”€â–ºâ”‚ SCA â”‚â”€â”€â”€â”€â–ºâ”‚PosTA â”‚  â”‚
                â”‚Buffer â”‚     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚ 4x4   â”‚         â”‚            â”‚           â”‚      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚            â”‚           â”‚      â”‚
                              B^TÃ—XÃ—B      Y âŠ™ G      A^TÃ—UÃ—A    â”‚
                                  â”‚            â”‚           â”‚      â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                              â”‚                   â”‚
                                        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”              â”‚
                                        â”‚   QMU    â”‚              â”‚
conv_mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Quality â”‚              â”‚
quality_mode[1:0] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Scale  â”‚              â”‚
                                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
                                              â”‚                   â”‚
                                        group_data                â”‚
                                        group_data_valid          â”‚
                                        group_done                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Latency: ~8-10 cycles (pipelined)
Throughput: 1 group per N cycles (after pipeline fill)
```

## DPM Processing Flow

### Before
```
FIFO â”€â”€â–º [Read Counter] â”€â”€â–º (nothing)
```

### After
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DPM State Machine                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  IDLE â”€â”€â–º READ_FEATURES â”€â”€â–º READ_OFFSETS â”€â”€â–º READ_REF         â”‚
â”‚    â–²            â”‚                 â”‚              â”‚             â”‚
â”‚    â”‚            â–¼                 â–¼              â–¼             â”‚
â”‚    â”‚       [Feature           [Offset        [Reference       â”‚
â”‚    â”‚        Buffer]           Buffers]        Buffer]         â”‚
â”‚    â”‚         4x4             3x3 (x,y)       16x16            â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€â”€â”€â”€â”€ OUTPUT â—„â”€â”€â”€â”€ COMPUTE_DEFORM                         â”‚
â”‚              â”‚               â”‚                                 â”‚
â”‚         dpm_out         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                          â”‚
â”‚         dpm_out_valid   â”‚ Bilinear â”‚                          â”‚
â”‚                         â”‚  Interp  â”‚                          â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                â”‚
â”‚  For each kernel position (i,j):                              â”‚
â”‚    pos = base + offset[i][j]                                  â”‚
â”‚    val = bilinear_interp(ref, pos)                            â”‚
â”‚    acc += val * feature[i][j]                                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Prefetcher Address Calculation

### Before
```
group_done â”€â”€â–º addr = 0x10000000 (fixed)
```

### After
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Split Prefetcher Logic                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Input:                                                     â”‚
â”‚    group_x, group_y        (group position in grid)        â”‚
â”‚    frame_width, frame_height (frame dimensions)            â”‚
â”‚    ref_frame_base_addr     (DRAM base address)             â”‚
â”‚                                                             â”‚
â”‚  Computation:                                               â”‚
â”‚    pixel_x = group_x Ã— TILE_SIZE                           â”‚
â”‚    pixel_y = group_y Ã— TILE_SIZE                           â”‚
â”‚                                                             â”‚
â”‚    offset = (pixel_y Ã— frame_width + pixel_x) Ã— 2 bytes   â”‚
â”‚                                                             â”‚
â”‚    addr = ref_frame_base_addr + offset                     â”‚
â”‚    len  = TILE_SIZE Ã— TILE_SIZE                            â”‚
â”‚                                                             â”‚
â”‚  Bounds Check:                                              â”‚
â”‚    if (pixel_x + TILE_SIZE > frame_width):                 â”‚
â”‚        adjust len                                           â”‚
â”‚    if (pixel_y + TILE_SIZE > frame_height):                â”‚
â”‚        adjust len                                           â”‚
â”‚                                                             â”‚
â”‚  Optimization:                                              â”‚
â”‚    Pre-calculate next address while waiting for ACK        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example:
  Frame: 1920Ã—1080, Group (10, 15), Tile 16
  â†’ pixel_x = 160, pixel_y = 240
  â†’ offset = (240 Ã— 1920 + 160) Ã— 2 = 921,600 bytes
  â†’ addr = base + 921,600
```

## Controller State Transitions

### Before
```
start â”€â”€â–º busy=1, sftm_busy=1, dpm_busy=1
(never transitions out)
```

### After
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”
                    â”‚ IDLE â”‚
                    â””â”€â”€â”€â”¬â”€â”€â”˜
                        â”‚ start
                    â”Œâ”€â”€â”€â–¼â”€â”€â”
                    â”‚ INIT â”‚ â”€â”€â”€ Initialize all modules
                    â””â”€â”€â”€â”¬â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    NORMAL_OP       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                    â”‚             â”‚
              â”‚  â€¢ Monitor FIFO    â”‚             â”‚
              â”‚  â€¢ Grant credits   â”‚             â”‚
              â”‚  â€¢ Enable modules  â”‚             â”‚
              â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜             â”‚
                â”‚              â”‚                 â”‚
     stall >10  â”‚              â”‚ FIFO relieved   â”‚
                â”‚              â”‚                 â”‚
            â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”‚
            â”‚ BYPASS_OP â”‚  â”‚  STALLED â”‚         â”‚
            â”‚           â”‚  â”‚          â”‚         â”‚
            â”‚ Skip      â”‚  â”‚ Throttle â”‚         â”‚
            â”‚ transform â”‚  â”‚ SFTM     â”‚         â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                  â”‚                              â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ !start && empty
                    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ WAIT_DRAIN â”‚ â”€â”€â”€ Flush pipeline
                    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ empty && !processing
                    â”Œâ”€â”€â”€â–¼â”€â”€â”
                    â”‚ DONE â”‚
                    â””â”€â”€â”€â”¬â”€â”€â”˜
                        â”‚
                    â”Œâ”€â”€â”€â–¼â”€â”€â”
                    â”‚ IDLE â”‚
                    â””â”€â”€â”€â”€â”€â”€â”˜

Adaptive Features:
  â€¢ FIFO > 75% full â†’ throttle producer
  â€¢ FIFO < 25% full â†’ accelerate producer
  â€¢ Stall > threshold â†’ enter bypass
  â€¢ Error detection â†’ STATE_ERROR
```

## Data Flow Comparison

### Before (Mock Data Flow)
```
Input â”€â”€â–º [Counter] â”€â”€â–º 0x0000, 0x0001, 0x0002, ... â”€â”€â–º FIFO
                              (dummy XOR data)
```

### After (Real Data Flow)
```
Video     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
Frame â”€â”€â”€â–ºâ”‚   SFTM     â”‚
Patches   â”‚  Pipeline  â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
         Transformed
         Features
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
          â”‚    FIFO    â”‚
          â”‚  (Buffer)  â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”        â”‚Referenceâ”‚
          â”‚    DPM     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤  Frame  â”‚
          â”‚ Deformable â”‚        â”‚ Prefetchâ”‚
          â”‚   Conv     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
         Reconstructed
           Output
```

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Module Performance                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Module           â”‚  Latency   â”‚ Through. â”‚ Resource       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SFTM Pipeline    â”‚  8-10 cyc  â”‚  1 grp/N â”‚ ~3000 LUTs     â”‚
â”‚ PreTA            â”‚  1-2 cyc   â”‚  1/cyc   â”‚ ~800 LUTs      â”‚
â”‚ SCA              â”‚  2-3 cyc   â”‚  1/cyc   â”‚ ~1000 LUTs     â”‚
â”‚ PosTA            â”‚  1-2 cyc   â”‚  1/cyc   â”‚ ~800 LUTs      â”‚
â”‚ QMU              â”‚  1 cyc     â”‚  1/cyc   â”‚ ~100 LUTs      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DPM              â”‚  ~50 cyc   â”‚  1 grp/  â”‚ ~2000 LUTs     â”‚
â”‚                  â”‚  per group â”‚  50 cyc  â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Prefetcher       â”‚  3-5 cyc   â”‚  1 req/  â”‚ ~200 LUTs      â”‚
â”‚                  â”‚            â”‚  3-5 cyc â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Controller       â”‚  N/A       â”‚  N/A     â”‚ ~300 LUTs      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total System: ~6500 LUTs + Memory
Clock Target: 100-200 MHz
```

## Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Memory Hierarchy                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Weight   â”‚     â”‚   Index    â”‚     â”‚ Reference  â”‚  â”‚
â”‚  â”‚  Regfile   â”‚     â”‚  Regfile   â”‚     â”‚   Buffer   â”‚  â”‚
â”‚  â”‚            â”‚     â”‚            â”‚     â”‚   16Ã—16    â”‚  â”‚
â”‚  â”‚  Model     â”‚     â”‚  Sparse    â”‚     â”‚            â”‚  â”‚
â”‚  â”‚ Dependent  â”‚     â”‚  Indices   â”‚     â”‚  512 bytes â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                  â”‚                  â”‚          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚    SRAM     â”‚                      â”‚
â”‚                    â”‚  On-chip    â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                           â”‚                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚    DRAM     â”‚                      â”‚
â”‚                    â”‚  Off-chip   â”‚                      â”‚
â”‚                    â”‚  (via AXI)  â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Quality-Throughput Tradeoff

```
Quality
  â†‘
  â”‚  â”Œâ”€â”€â”€â”€â”€â”
  â”‚  â”‚     â”‚  Normal Mode
  â”‚  â”‚     â”‚  (Full Transform)
  â”‚â”€â”€â”¤     â”‚
  â”‚  â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚        â”Œâ”€â”€â”€â”€â”
  â”‚        â”‚    â”‚  Bypass Mode
  â”‚        â”‚    â”‚  (Skip Transform)
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
  â”‚        â”‚    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Throughput

Transition Points:
  â€¢ Stall counter > 10 cycles â†’ Enter bypass
  â€¢ FIFO count < 25% â†’ Exit bypass
  â€¢ Adaptive based on system load
```

## Integration Checklist

```
â˜‘ 1. Add SCA module to project
â˜‘ 2. Update SFTM with new interfaces:
     - input_data, input_valid
     - conv_mode, quality_mode
     - weight_addr, weight_data
â˜‘ 3. Update DPM with new interfaces:
     - ref_data, ref_data_valid
     - dpm_out, dpm_out_valid
â˜‘ 4. Update split_prefetcher:
     - frame configuration
     - group position tracking
â˜‘ 5. Update global_controller:
     - new status inputs
     - new control outputs
â˜ 6. Modify vcnpu_top to connect new signals
â˜ 7. Add weight memory to top level
â˜ 8. Add group position tracking
â˜ 9. Connect DPM output to system output
â˜ 10. Create testbench for integrated system
â˜ 11. Synthesize and check timing
â˜ 12. Validate against golden model
```